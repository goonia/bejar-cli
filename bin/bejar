#!/usr/bin/env ruby
require 'bejar'
require 'thor'

class Bejarcli < Thor

  desc "init", "init a bejar project"
  def init(project)

    if File.exist? project
      puts "#{project} directory currently exists."
    else
      Dir.mkdir(project)
      puts "Project inited"
      Dir.chdir(Dir.pwd + "/#{project}") do
        system("git clone git@github.com:goonia/bejar.git .")
        puts "project cloned"
        system("rm -rf .git/")
      end
    end

  end

  desc "up", "start webserver"
  def up
    f = File.new("config.ru", "w")
    f.puts "Bundler.require\n\n"
    f.puts "require_relative 'bejar/main'"
    f.puts  "require_relative 'bejar/routes/bejar.rb'"

    Dir.chdir("bejar/routes") do
      Dir.entries(Dir.pwd).each do |item|
        next if item == "." || item == ".."
        next unless File.directory? item
        f.puts "require_relative 'bejar/routes/#{item}/#{item}.rb'"
        puts item
      end
    end

    f.puts "run Bejar"
    f.close

    system("rackup -p 2048")
  end

end

Bejarcli.start(ARGV)
